@inherits FullComponentBase

<MudTabPanel Text="Habilitations" OnClick="@OnClick">
    <MudGrid Justify="Justify.Center" Spacing="0">
        <MudItem Class="px-2 px-md-16" xs="12">
            <MudStack Row>
                <HideableBreadcrumb Items="@_breadcrumbs" Class="open-sans" />
                <MudSpacer/>
                <MudPaper Class="my-4 px-4 py-3" Elevation="2">
                    <MudStack Row AlignItems="AlignItems.Center">
                        <MudAvatar Color="Color.Dark">@User.Name[0].ToString().ToUpper()</MudAvatar>
                        <MudStack Row="false" Spacing="0">
                            <MudText Class="open-sans-600">@User.Name</MudText>
                            <MudText Class="open-sans-600">@User.Email</MudText>
                            <MudLink Href="@($"tel:{@User.PhoneNumber}")" Color="Color.Inherit">
                                <MudText Class="open-sans-600" Typo="Typo.body2">@User.PhoneNumber</MudText>
                            </MudLink>
                        </MudStack>
                    </MudStack>
                </MudPaper>
            </MudStack>
        </MudItem>
        
        <MudItem Class="px-2 px-md-16" xs="12">
            <MudStack Class="py-2" Row="false" Spacing="3">
                @foreach (var group in _groupedCertifications.Keys)
                {
                    <MudPaper Elevation="4">
                        <MudStack Class="px-4 py-1" Row AlignItems="AlignItems.Center">
                            <MudText Class="open-sans-600 bold" Align="Align.Left" Style="min-width: 120px;">@group</MudText>
                            <MudGrid Spacing="0" Justify="Justify.FlexStart">
                                @foreach (var certification in _groupedCertifications[group])
                                {
                                    if (certification.Enabled)
                                    {
                                        <MudItem xs="6" md="3" lg="2" xl="1">
                                            <MudStack Row AlignItems="AlignItems.Center">
                                                <MudCheckBox T="bool" Value="@_userSafetyCertifications.Select(x => x.CertId).Contains(certification.Id)"
                                                             ValueChanged="@(async (value) => await OnCheckChangedAsync(value, certification.Id))" Label="@certification.Name"
                                                             StopClickPropagation DisableRipple/>

                                                @{
                                                    var userCertification = _userSafetyCertifications.FirstOrDefault(x => x.CertId == certification.Id);
                                                    if (userCertification != null && userCertification.ExpireDate.HasValue)
                                                    {
                                                        <MudIcon Size="Size.Small" Icon="@IconsR.Info" Color="Color.Info" Title="@($"Expire dans {(userCertification.ExpireDate.Value - DateTime.Now).DisplayRemainingTime()}")"/>
                                                    }
                                                }
                                            </MudStack>
                                        </MudItem>
                                    }
                                }
                            </MudGrid>
                        </MudStack>
                    </MudPaper>
                }
            </MudStack>
        </MudItem>
    </MudGrid>
</MudTabPanel>