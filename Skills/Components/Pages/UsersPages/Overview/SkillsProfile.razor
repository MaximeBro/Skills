<MudTabPanel Text="Compétences">
    <MudGrid Justify="Justify.Center" Spacing="0">

        @* User information *@
        <MudItem Class="px-2 px-md-16" xs="12">
            <MudStack Row>
                <HideableBreadcrumb Items="@_breadcrumbs" Class="open-sans" />
                <MudSpacer />
                <MudPaper Class="my-4 px-4 py-3" Elevation="2">
                    <MudStack Row AlignItems="AlignItems.Center">
                        <MudAvatar Color="Color.Dark">@User.Name[0].ToString().ToUpper()</MudAvatar>
                        <MudStack Row="false" Spacing="0">
                            <MudText Class="open-sans-600">@User.Name</MudText>
                            <MudText Class="open-sans-600">@User.Email</MudText>
                            <MudLink Href="@($"tel:{@User.PhoneNumber}")" Color="Color.Inherit">
                                <MudText Class="open-sans-600" Typo="Typo.body2">@User.PhoneNumber</MudText>
                            </MudLink>
                        </MudStack>
                    </MudStack>
                </MudPaper>
            </MudStack>
        </MudItem>

        @* Skills *@
        <MudItem Class="px-2 px-md-16" xs="12">
            
            <MudDataGrid T="UserSkillModel" Items="_userSkillsModels" Bordered Hover Outlined Filterable Striped SortMode="SortMode.Multiple" Dense FixedHeader ReadOnly="false"
                         Culture="@(new CultureInfo("fr-FR"))" Height="65vh" Virtualize OverscanCount="25" QuickFilter="@QuickFilter" EditMode="DataGridEditMode.Cell">
                <ToolBarContent>
                    <MudText Class="open-sans-600">Compétences (attribuées)</MudText>
                    <AuthorizeView Roles="Admin, Manager">
                        <Authorized>
                            <MudTooltip Class="ml-2" Placement="Placement.Bottom" Text="Exporter compétences" Arrow>
                                <MudIconButton Class="ml-4" Style="border-radius: 6px!important; padding: 4px!important;" Icon="@IconsFF.FileExcel" Color="Color.Tertiary" OnClick="@(async() => await ExportSkillsAsync())"/>
                            </MudTooltip>
                            <MudTooltip Class="ml-2" Placement="Placement.Top" Text="Importer compétences" Arrow>
                                <MudIconButton Class="ml-4" Style="border-radius: 6px!important; padding: 4px!important;" Icon="@IconsF.UploadFile" Color="Color.Secondary" OnClick="@(async() => await ImportSkillsAsync())"/>
                            </MudTooltip>
                            <MudTooltip Class="ml-3" Placement="Placement.Bottom" Text="Gérer les compétences" Arrow>
                                <MudButton Class="ml-6" StartIcon="@IconsF.Checklist" Size="Size.Small"
                                           Color="Color.Tertiary" Variant="Variant.Filled" OnClick="@(async () => await ManageSkillsAsync())">
                                    Attribution
                                </MudButton>
                            </MudTooltip>
                        </Authorized>
                    </AuthorizeView>
                    
                    <MudSpacer/>
                    <MudTextField T="string" @bind-Value="_search" Placeholder="Rechercher" Clearable Adornment="Adornment.Start" AdornmentIcon="@IconsF.Search" />
                </ToolBarContent>
                <Columns>
                    <HierarchyColumn T="UserSkillModel" />
                    <PropertyColumn Title="Type" Property="x => x.Skill!.Type" IsEditable="false" />
                    <PropertyColumn Title="Catégorie" Property="x => x.Skill!.Category" IsEditable="false" />
                    <PropertyColumn Title="Sous catégorie" Property="x => x.Skill!.SubCategory" IsEditable="false" />
                    <PropertyColumn Title="Description" Property="x => x.Skill!.Description" IsEditable="false" />
                    <PropertyColumn Title="Niveau" Property="x => x.Level" IsEditable>
                        <EditTemplate>
                            <MudSelect T="int" Value="context.Item.Level" ValueChanged="@(async(value) => await LevelChangedAsync(value, context.Item))" 
                                       AnchorOrigin="Origin.BottomLeft" TransformOrigin="Origin.TopLeft" Immediate>
                                <MudSelectItem Value="0">0</MudSelectItem>
                                <MudSelectItem Value="1">1</MudSelectItem>
                                <MudSelectItem Value="2">2</MudSelectItem>
                                <MudSelectItem Value="3">3</MudSelectItem>
                                <MudSelectItem Value="4">4</MudSelectItem>
                            </MudSelect>
                        </EditTemplate>
                    </PropertyColumn>
                </Columns>
                <ChildRowContent>
                    <MudStack Row="false" Spacing="0">
                        <MudText Class="bold" GutterBottom>Niveau sélectionné</MudText>
                        <MudStack Class="px-2" Row Spacing="5" AlignItems="AlignItems.Center">
                            @{
                                foreach (var level in _rowSkillLevels[context.Item.SkillId].OrderBy(x => x.Level))
                                {
                                    if (_selectedLevels[context.Item.SkillId] != null && level.Level == _selectedLevels[context.Item.SkillId]!      .Level)
                                    {
                                        <MudText Class="open-sans-600 bold" Color="Color.Tertiary">
                                            <MudChip Class="bold" Color="Color.Tertiary" Size="Size.Small">@level.Level</MudChip> @level.Value
                                        </MudText>
                                    }
                                    else
                                    {
                                        <MudText Class="open-sans-600">
                                            <MudChip Class="bold" Size="Size.Small">@level.Level</MudChip> @level.Value
                                        </MudText>
                                    }
                                }
                            }
                        </MudStack>
                    </MudStack>
                </ChildRowContent>
            </MudDataGrid>
        </MudItem>
    </MudGrid>
</MudTabPanel>