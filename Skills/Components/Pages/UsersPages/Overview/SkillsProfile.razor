<MudTabPanel Text="Compétences">
    <MudGrid Justify="Justify.Center" Spacing="0">

        @* User information *@
        <MudItem Class="px-16" xs="12">
            <MudStack Row>
                <MudPaper Class="my-4 px-4 py-3" Elevation="2">
                    <MudStack Row AlignItems="AlignItems.Center">
                        <MudAvatar Color="Color.Dark">@User.Name[0].ToString().ToUpper()</MudAvatar>
                        <MudStack Row="false" Spacing="0">
                            <MudText Class="mark-one">@User.Name</MudText>
                            <MudText Class="mark-one">@User.Email</MudText>
                        </MudStack>
                    </MudStack>
                </MudPaper>
                <MudSpacer/>
            </MudStack>
        </MudItem>

        @* Skills *@
        <MudItem Class="px-16" xs="12">
            
            <MudDataGrid T="UserSkillModel" Items="_userSkillsModels" Bordered Hover Outlined Filterable Striped SortMode="SortMode.Multiple" Dense FixedHeader
                         Culture="@(new CultureInfo("fr-FR"))" Height="65vh" Virtualize OverscanCount="25" QuickFilter="@QuickFilter">
                <ToolBarContent>
                    <MudText Class="mark-one">Compétences (attribuées)</MudText>
                    <AuthorizeView Roles="Admin, Manager">
                        <Authorized>
                            <MudTooltip Class="ml-2" Placement="Placement.Bottom" Text="Ajouter une compétence" Arrow>
                                <MudIconButton Class="ml-4" Style="border-radius: 6px!important; padding: 4px!important;" Icon="@IconsF.Add" Color="Color.Tertiary" OnClick="@(async() => await GrantSkillAsync())"/>
                            </MudTooltip>
                        </Authorized>
                    </AuthorizeView>
                    
                    <MudSpacer/>
                    <MudTextField T="string" @bind-Value="_search" Placeholder="Rechercher" Clearable Adornment="Adornment.Start" AdornmentIcon="@IconsF.Search" />
                </ToolBarContent>
                <Columns>
                    <HierarchyColumn T="UserSkillModel" />
                    <TemplateColumn Title="Type">
                        <CellTemplate>
                            <MudText Class="mark-one">@(context.Item.Skill?.Type ?? string.Empty)</MudText>
                        </CellTemplate>
                    </TemplateColumn>
                    <TemplateColumn Title="Catégorie">
                        <CellTemplate>
                            <MudText Class="mark-one">@(context.Item.Skill?.Category ?? string.Empty)</MudText>
                        </CellTemplate>
                    </TemplateColumn>
                    <TemplateColumn Title="Sous catégorie">
                        <CellTemplate>
                            <MudText Class="mark-one">@(context.Item.Skill?.SubCategory ?? string.Empty)</MudText>
                        </CellTemplate>
                    </TemplateColumn>
                    <TemplateColumn Title="Description">
                        <CellTemplate>
                            <MudText Class="mark-one">@(context.Item.Skill?.Description ?? string.Empty)</MudText>
                        </CellTemplate>
                    </TemplateColumn>
                    <PropertyColumn Title="Niveau" Property="x => x.Level"/>
                    <AuthorizeView Roles="Admin, Manager" Context="auth">
                        <Authorized>
                            <TemplateColumn Title="Actions" Filterable="false" Sortable="false">
                                <CellTemplate>
                                    <MudTooltip Placement="Placement.Bottom" Text="Éditer" Arrow>
                                        <MudIconButton Icon="@IconsF.Edit" Size="Size.Small" Color="Color.Primary" OnClick="@(async () => await ManageSkillAsync(context.Item))"/>
                                    </MudTooltip>
                                    <MudTooltip Class="ml-2" Placement="Placement.Bottom" Text="Supprimer" Arrow>
                                        <MudIconButton Class="ml-4" Icon="@IconsF.Delete" Size="Size.Small" Color="Color.Error" OnClick="@(async () => await RevokeSkillAsync(context.Item))"/>
                                    </MudTooltip>
                                </CellTemplate>
                            </TemplateColumn>
                        </Authorized>
                    </AuthorizeView>
                </Columns>
                <ChildRowContent>
                    <MudStack Row="false" Spacing="0">
                        <MudText Style="font-weight: bold;" GutterBottom>Niveau sélectionné</MudText>
                        <MudStack Class="px-2" Row Spacing="0">
                            <MudText Class="mark-one">
                                <MudChip Size="Size.Small" Style="font-weight: bold;">@context.Item.Level</MudChip> @_selectedLevels[context.Item.SkillId]
                            </MudText>
                        </MudStack>
                    </MudStack>
                </ChildRowContent>
            </MudDataGrid>
        </MudItem>
    </MudGrid>
</MudTabPanel>