@inherits FullComponentBase
@attribute [Authorize(Roles = "Admin, Manager")]

<MudTabPanel Text="CV">
    <MudGrid Justify="Justify.Center" Spacing="0">
        <MudItem Class="px-2 px-md-16" xs="12">
            <MudStack Row>
                <HideableBreadcrumb Items="@_breadcrumbs" Class="open-sans" />
                <MudSpacer/>
                <MudPaper Class="my-4 px-4 py-3" Elevation="2">
                    <MudStack Row AlignItems="AlignItems.Center">
                        <MudAvatar Color="Color.Dark">@User.Name[0].ToString().ToUpper()</MudAvatar>
                        <MudStack Row="false" Spacing="0">
                            <MudText Class="open-sans-600">@User.Name</MudText>
                            <MudText Class="open-sans-600">@User.Email</MudText>
                            <MudLink Href="@($"tel:{@User.PhoneNumber}")" Color="Color.Inherit">
                                <MudText Class="open-sans-600" Typo="Typo.body2">@User.PhoneNumber</MudText>
                            </MudLink>
                        </MudStack>
                    </MudStack>
                </MudPaper>
            </MudStack>
        </MudItem>

        <AuthorizedComponent Roles="Admin, Manager" ShowDialog="false">
            <Content>
                <MudItem Class="px-2 px-md-16 mb-6" xs="12">
                    <MudPaper Elevation="2">
                        <MudToolBar Dense>
                            <MudTooltip Text="@SortActionText" Placement="Placement.Right" Arrow>
                                <MudIconButton Icon="@SortActionIcon" Size="Size.Small" Style="border-radius: 6px!important; padding: 4px!important;" Color="@(Layout.IsDarkMode ? Color.Default : Color.Dark)" OnClick="@OnSortChanged"/>
                            </MudTooltip>
                            <MudTooltip Class="ml-2" Text="Créer un CV" Placement="Placement.Top" Arrow>
                                <MudIconButton Class="ml-4" Icon="@IconsF.AddBox" Style="border-radius: 6px!important; padding: 4px!important;" Color="Color.Tertiary" OnClick="@CreateCvAsync"/>
                            </MudTooltip>
                        </MudToolBar>
                    </MudPaper>
                </MudItem>
            </Content>
        </AuthorizedComponent>

        <MudItem Class="px-2 px-md-16" xs="12">
            <MudGrid Justify="Justify.FlexStart" Spacing="2">
                @foreach (var cv in _cvs)
                {
                    <MudItem xs="12" sm="6" md="4">
                        <MudPaper Class="px-8 py-4" Elevation="2">
                            <MudStack Row="false">
                                <MudStack Row>
                                    <MudText Class="open-sans-600 bold">@cv.Title</MudText>
                                    <MudSpacer/>
                                    <MudTooltip Text="Télécharger" Placement="Placement.Bottom" Arrow>
                                        <MudIconButton Color="Color.Primary" Size="Size.Small" Icon="@IconsFF.FileWord" OnClick="@(async() => await ExportCvAsync(cv))" />
                                    </MudTooltip>
                                    <AuthorizedComponent Roles="Admin, Manager">
                                        <Content>
                                            <MudTooltip Text="Éditer" Placement="Placement.Top" Arrow>
                                                <MudIconButton Color="Color.Primary" Size="Size.Small" Icon="@IconsF.Edit" OnClick="@(() => NavManager.NavigateTo($"/overview/{User.Username}/cv-editor/{cv.Id}"))"/>
                                            </MudTooltip>
                                            <MudTooltip Text="Supprimer" Placement="Placement.Bottom" Arrow>
                                                <MudIconButton Class="hover-red" Size="Size.Small" Color="@(Layout.IsDarkMode ? Color.Default : Color.Dark)" Icon="@IconsO.Delete" OnClick="@(async () => await DeleteCvAsync(cv))"/>
                                            </MudTooltip>
                                        </Content>
                                    </AuthorizedComponent>
                                </MudStack>
                                <MudDivider Class="my-2 mt-2" DividerType="DividerType.Middle"/>
                                <MudText Class="open-sans-600">Compétences @(cv.Skills.Count) (dont @cv.Skills.Count(x => x.IsSoftSkill) soft-skill(s))</MudText>
                                <MudText Class="open-sans-600">Formations @cv.Certifications.Count</MudText>
                                <MudText Class="open-sans-600">Diplômes @cv.Educations.Count</MudText>
                                <MudText Class="open-sans-600">Expériences @cv.Experiences.Count</MudText>
                                <MudStack Justify="Justify.FlexEnd" Row>
                                    <MudStack Row="false" Spacing="0">
                                        <MudSpacer/>
                                        <MudText Class="open-sans-600" Typo="Typo.caption" Align="Align.Right">créé le @cv.CreatedAt.ToString("dd-MM-yyyy")</MudText>
                                        <MudStack Row AlignItems="AlignItems.Center">
                                            @if (cv.UpdatedAt.IsOlderThan(180))
                                            {
                                            <MudTooltip Text="Ce CV n'a pas été mis à jour depuis plus de 6 mois !" Placement="Placement.Left" Arrow>
                                                <MudIcon Icon="@IconsF.Warning" Color="Color.Warning" Size="Size.Small" />
                                            </MudTooltip>
                                            }
                                            <MudText Class="open-sans-600" Typo="Typo.caption" Align="Align.Right">mis à jour le @cv.UpdatedAt.ToString("dd-MM-yyyy")</MudText>
                                        </MudStack>
                                    </MudStack>
                                </MudStack>
                            </MudStack>
                        </MudPaper>
                    </MudItem>
                }
            </MudGrid>
        </MudItem>
    </MudGrid>
</MudTabPanel>

<PageLoading IsVisible="@_loading" />