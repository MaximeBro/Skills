@page "/skills"
@inherits FullComponentBase

<MudContainer Class="mb-8" MaxWidth="MaxWidth.ExtraLarge">
    <HideableBreadcrumb Items="@_breadcrumbs" Class="open-sans" />
    <MudText Class="open-sans-600" Typo="Typo.h2" Align="Align.Center">Compétences</MudText>
    <MudGrid Justify="Justify.Center">
        <MudItem Class="mt-4" xs="12">
            <MudDataGrid @ref="_grid" T="AbstractSkillModel" Items="_models" QuickFilter="@QuickFilter" Loading="@_loading" Bordered Hover Outlined Filterable Striped SortMode="SortMode.Multiple" 
                         Dense FixedHeader Culture="@(new CultureInfo("fr-FR"))" Height="70vh" Virtualize OverscanCount="5" ItemSize="39" RowClick="@OnRowClicked"> 
                <ToolBarContent>
                    <MudSpacer/>
                    <MudTextField T="string" @bind-Value="_search" Immediate Adornment="Adornment.Start" Clearable 
                                  AdornmentIcon="@IconsF.Search" Placeholder="Rechercher" Class="flex-grow-0 mr-8 mt-0" Style="width: 400px;"/>
                </ToolBarContent>
                <Columns>
                    <HierarchyColumn T="AbstractSkillModel"/>
                    <PropertyColumn Title="Catégorie" Property="x => x.Category"/>
                    <PropertyColumn Title="Sous catégorie" Property="x => x.SubCategory"/>
                    <PropertyColumn Title="Description" Property="x => x.Description"/>
                    <TemplateColumn Filterable="false" Sortable="false" Groupable="false">
                        <CellTemplate>
                            <MudStack Row Justify="Justify.Center">
                                <MudTooltip Arrow Placement="Placement.Left" Text="Liste des utilisateurs possédant la compétence.">
                                    <MudIconButton Size="Size.Small" Icon="@IconsF.OpenInNew" Color="Color.Secondary" OnClick="@(() => NavManager.NavigateTo($"/skill-users/{context.Item.Id}"))"/>
                                </MudTooltip>
                            </MudStack>
                        </CellTemplate>
                    </TemplateColumn>
                </Columns>
                <ChildRowContent>
                    <MudStack Row="false" Spacing="0">
                        <MudText Style="font-weight: bold;" GutterBottom>Niveaux</MudText>
                        <MudStack Class="px-2" Row="false" Spacing="0">
                            @if (_skillTypeLevels[context.Item.Id].Any())
                            {
                                @foreach (var typeLevel in _skillTypeLevels[context.Item.Id].OrderBy(x => x.Level))
                                {
                                    <MudStack Row Justify="Justify.FlexStart">
                                        <MudText Class="open-sans-600" Typo="Typo.body2">
                                            <MudChip Size="Size.Small" Style="font-weight: bold!important;">@typeLevel.Level</MudChip> @typeLevel.Value
                                        </MudText>
                                    </MudStack>
                                }
                            }
                            else if (_softSkillTypeLevels[context.Item.Id].Any())
                            {
                                @foreach (var typeLevel in _softSkillTypeLevels[context.Item.Id].OrderBy(x => x.Level))
                                {
                                    <MudStack Row Justify="Justify.FlexStart">
                                        <MudText Class="open-sans-600" Typo="Typo.body2">
                                            <MudChip Size="Size.Small" Style="font-weight: bold!important;">@typeLevel.Level</MudChip> @typeLevel.Value
                                        </MudText>
                                    </MudStack>
                                }
                            }
                            else
                            {
                                <MudAlert Class="mb-1" Severity="Severity.Normal">Aucun niveau défini pour ce type de compétence.</MudAlert>
                            }
                        </MudStack>
                    </MudStack>
                </ChildRowContent>
            </MudDataGrid>
        </MudItem>
    </MudGrid>
</MudContainer>